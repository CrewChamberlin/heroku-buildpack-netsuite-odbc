#!/bin/bash

arrow() {
  echo '----->' "$@"
}

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1

# Load environment variables
source /app/.heroku/python/bin/activate

mkdir -p "${BUILD_DIR}/.apt/usr/lib/netsuite/odbc/conf" | indent
cp odbcinst.ini "${BUILD_DIR}/.apt/usr/lib/netsuite/odbc/conf/odbcinst.ini" | indent

arrow "Adding profile.d script"
mkdir -p "${BUILD_DIR}/.profile.d" | indent
cp .profile.d/oaodbc64.sh "${BUILD_DIR}/.profile.d" | indent

arrow "Create bin dir"
mkdir -p "${BUILD_DIR}/.apt/usr/lib/netsuite/odbc/bin" | indent

arrow "Downloading ODBC driver from ${NS_ODBC_DRIVER}"
curl -L ${NS_ODBC_DRIVER} -o "${BUILD_DIR}/netsuite_odbcdrivers_linux64bit/NetSuiteODBCDrivers_Linux64bit.zip" | indent

arrow "Unzipping ODBC driver"
unzip "${BUILD_DIR}/netsuite_odbcdrivers_linux64bit/NetSuiteODBCDrivers_Linux64bit.zip" -d "${BUILD_DIR}/.apt/usr/lib/netsuite/odbc/bin/" | indent

arrow "Listing files in bin directory"
ls -al "${BUILD_DIR}/.apt/usr/lib/netsuite/odbc/bin/" | indent
